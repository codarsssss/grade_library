{% extends "base.html" %}

{% block title %}Каталог книг{% endblock %}

{% block content %}
<h1 class="mb-4">Каталог книг</h1>

<form method="get" class="row g-3 mb-4" id="filter-form">
  <div class="col-md-4">
    <input type="text" name="query" class="form-control" placeholder="Поиск по названию"
           value="{{ current_query }}">
  </div>
  <div class="col-md-2">
    <select name="genre" class="form-select">
      <option value="">Все жанры</option>
      {% for genre in genres %}
        <option value="{{ genre.id }}" {% if genre.id|stringformat:"s" == current_genre %}selected{% endif %}>
          {{ genre.name }}
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <select name="author" class="form-select">
      <option value="">Все авторы</option>
      {% for author in authors %}
        <option value="{{ author.id }}" {% if author.id|stringformat:"s" == current_author %}selected{% endif %}>
          {{ author.full_name }}
        </option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <input type="date" name="date_from" class="form-control" value="{{ date_from }}">
  </div>
  <div class="col-md-2">
    <input type="date" name="date_to" class="form-control" value="{{ date_to }}">
  </div>
  <div class="col-md-12 text-end">
    <button type="submit" class="btn btn-primary">Фильтровать</button>
  </div>
</form>



<div id="book-container">
    {% include "books/includes/_book_list.html" %}
</div>

{% endblock %}

{% block scripts %}
<script>
  $(function () {
    $("form").on("submit", function (e) {
      e.preventDefault();
      const url = $(this).attr("action") || window.location.href;
      const data = $(this).serialize();

      $.ajax({
        url: url,
        data: data,
        success: function (response) {
          $("#book-container").html(response.html);
        },
        error: function () {
          alert("Ошибка при загрузке данных.");
        }
      });
    });
  });
</script>
{% endblock %}

